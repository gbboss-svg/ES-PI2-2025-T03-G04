-- Use este script para criar a tabela de professores no Oracle
-- Lembre-se de estar conectado ao usuário/schema correto

CREATE TABLE professores (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome VARCHAR2(255) NOT NULL,
  email VARCHAR2(255) UNIQUE NOT NULL,
  cpf VARCHAR2(14) UNIQUE NOT NULL,
  celular VARCHAR2(20) NOT NULL,
  senha VARCHAR2(255) NOT NULL,
  is_verified NUMBER(1) DEFAULT 0 CHECK (is_verified IN (0, 1)),
  primeiro_acesso NUMBER(1) DEFAULT 1 CHECK (primeiro_acesso IN (0, 1)), -- 1 para sim, 0 para não
  verification_code VARCHAR2(6),
  verification_attempts NUMBER(1) DEFAULT 0,
  resend_attempts NUMBER(1) DEFAULT 0,
  reset_password_token VARCHAR2(255),
  reset_password_expires TIMESTAMP,
  data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE instituicoes (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome VARCHAR2(255) NOT NULL,
  cnpj VARCHAR2(18) UNIQUE NOT NULL,
  endereco VARCHAR2(255),
  data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE cursos (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome VARCHAR2(255) NOT NULL,
  data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE professor_instituicao_curso (
  professor_id NUMBER NOT NULL,
  instituicao_id NUMBER NOT NULL,
  curso_id NUMBER NOT NULL,
  PRIMARY KEY (professor_id, instituicao_id, curso_id),
  CONSTRAINT fk_pic_professor FOREIGN KEY (professor_id) REFERENCES professores(id) ON DELETE CASCADE,
  CONSTRAINT fk_pic_instituicao FOREIGN KEY (instituicao_id) REFERENCES instituicoes(id) ON DELETE CASCADE,
  CONSTRAINT fk_pic_curso FOREIGN KEY (curso_id) REFERENCES cursos(id) ON DELETE CASCADE
);


-- O comando COMMIT é importante no Oracle para salvar as alterações
COMMIT;
