-- Use este script para criar a tabela de professores no Oracle
-- Lembre-se de estar conectado ao usuário/schema correto

CREATE TABLE professores (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome VARCHAR2(255) NOT NULL,
  email VARCHAR2(255) UNIQUE NOT NULL,
  cpf VARCHAR2(14) UNIQUE NOT NULL,
  celular VARCHAR2(20) NOT NULL,
  senha VARCHAR2(255) NOT NULL,
  is_verified NUMBER(1) DEFAULT 0 CHECK (is_verified IN (0, 1)),
  primeiro_acesso NUMBER(1) DEFAULT 1 CHECK (primeiro_acesso IN (0, 1)), -- 1 para sim, 0 para não
  verification_code VARCHAR2(6),
  verification_attempts NUMBER(1) DEFAULT 0,
  resend_attempts NUMBER(1) DEFAULT 0,
  reset_password_token VARCHAR2(255),
  reset_password_expires TIMESTAMP,
  data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE Instituicao (
Id_Instituicao NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
Nome VARCHAR2(100) NOT NULL
);

CREATE TABLE Curso (
Id_Curso NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
Nome VARCHAR2(100) NOT NULL,
Id_Instituicao NUMBER NOT NULL,
CONSTRAINT fk_curso_instituicao FOREIGN KEY (Id_Instituicao)
  REFERENCES Instituicao(Id_Instituicao)
);

CREATE TABLE Disciplina (
Id_Disciplina NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
Nome VARCHAR2(100) NOT NULL,
Sigla VARCHAR2(10),
Periodo VARCHAR2(20),
Id_Curso NUMBER NOT NULL,
CONSTRAINT fk_disciplina_curso FOREIGN KEY (Id_Curso)
  REFERENCES Curso (Id_Curso)
);

CREATE TABLE Aluno ( 
Matricula NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
Nome VARCHAR2(100) NOT NULL
);

CREATE TABLE Turma ( 
Id_Turma NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
Id_Disciplina NUMBER NOT NULL,
CONSTRAINT fk_turma_disciplina FOREIGN KEY (Id_Disciplina)
  REFERENCES Disciplina (Id_Disciplina)
);

-- Tabela de ligação entre Aluno e Turma
CREATE TABLE Aluno_Turma (
  Id_Aluno_Turma NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  Matricula NUMBER NOT NULL,
  Id_Turma NUMBER NOT NULL,
  Data_Matricula TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_aluno_turma_aluno FOREIGN KEY (Matricula)
    REFERENCES Aluno (Matricula),
  CONSTRAINT fk_aluno_turma_turma FOREIGN KEY (Id_Turma)
    REFERENCES Turma (Id_Turma)
);

CREATE TABLE Notas (
Id_Nota NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
Pontuacao NUMBER(5,2),
Matricula NUMBER NOT NULL,
Id_Turma NUMBER NOT NULL,
CONSTRAINT fk_notas_aluno FOREIGN KEY (Matricula)
  REFERENCES Aluno (Matricula),
CONSTRAINT fk_notas_turma FOREIGN KEY (Id_Turma)
  REFERENCES Turma (Id_Turma)
);

-- O comando COMMIT é importante no Oracle para salvar as alterações
COMMIT;
